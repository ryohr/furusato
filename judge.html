<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>地場産品基準 判定フローチャート</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --primary: #2c7a7b;
      --primary-dark: #225c5c;
      --accent: #f6ad55;
      --bg: #f7fafc;
      --card: #ffffff;
      --text: #2d3748;
      --muted: #718096;
      --danger: #c53030;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 24px;
      font-family: "Hiragino Sans", "Yu Gothic", "Meiryo", sans-serif;
      background: linear-gradient(135deg, #e6fffa 0%, #edf2f7 100%);
      color: var(--text);
    }
    main {
      max-width: 960px;
      margin: 0 auto;
    }
    .card {
      background: var(--card);
      border-radius: 18px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.08);
      padding: 32px;
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(140deg, rgba(44,122,123,0.08), rgba(246,173,85,0.08));
      pointer-events: none;
    }
    h1 {
      margin-top: 0;
      font-size: 1.8rem;
      color: var(--primary-dark);
      letter-spacing: 0.03em;
    }
    p.lead {
      margin: 0 0 24px;
      color: var(--muted);
    }
    section {
      position: relative;
      z-index: 1;
    }
    ol#trail {
      padding-left: 1.2rem;
      margin: 0 0 24px;
      color: var(--muted);
      font-size: 0.95rem;
    }
    .question-area {
      margin-bottom: 24px;
    }
    .question-area h2 {
      margin: 0 0 12px;
      font-size: 1.25rem;
      color: var(--primary-dark);
    }
    .question-area p {
      margin: 0 0 12px;
      line-height: 1.6;
    }
    .options {
      display: grid;
      gap: 12px;
    }
    button.option {
      padding: 14px 18px;
      border-radius: 12px;
      border: 1px solid transparent;
      background: rgba(44,122,123,0.12);
      color: var(--primary-dark);
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }
    button.option:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 18px rgba(44,122,123,0.15);
      background: rgba(44,122,123,0.18);
    }
    button.option:active {
      transform: translateY(1px);
      box-shadow: none;
    }
    #result {
      margin: 0;
      padding: 18px 24px;
      border-radius: 14px;
      background: rgba(246,173,85,0.12);
      color: var(--primary-dark);
      font-weight: 600;
      line-height: 1.7;
      display: none;
    }
    #result ul {
      margin: 8px 0 0;
      padding-left: 20px;
    }
    .actions {
      display: flex;
      gap: 12px;
      margin-top: 28px;
    }
    .actions button {
      flex: 1;
      padding: 14px 18px;
      border-radius: 12px;
      border: none;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.15s ease, transform 0.15s ease;
    }
    .actions button.primary {
      background: var(--primary);
      color: #fff;
    }
    .actions button.primary:hover {
      background: var(--primary-dark);
    }
    .actions button.secondary {
      background: #e2e8f0;
      color: var(--text);
    }
    .actions button.secondary:hover {
      background: #cbd5f5;
    }
    .actions button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    aside {
      margin-top: 24px;
      font-size: 0.92rem;
      color: var(--muted);
      padding: 18px 24px;
      background: rgba(255,255,255,0.65);
      border-left: 4px solid var(--primary);
      border-radius: 12px;
    }
    @media (max-width: 640px) {
      body {
        padding: 16px;
      }
      .card {
        padding: 24px 20px;
      }
      .actions {
        flex-direction: column;
      }
      .actions button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <main>
    <div class="card">
      <section>
        <h1>地場産品基準 判定フローチャート</h1>
        <p class="lead">質問に順番に回答して、該当する類型を確認してください。</p>

        <h3>進行状況</h3>
        <ol id="trail">
          <li>開始</li>
        </ol>

        <div class="question-area" id="questionArea">
          <h2 id="questionTitle">種別を選択</h2>
          <p id="questionText">該当する返礼品の種別を選択してください。</p>
          <div class="options" id="options"></div>
        </div>

        <div id="result" aria-live="polite"></div>

        <div class="actions">
          <button id="backButton" class="secondary" disabled>1つ戻る</button>
          <button id="restartButton" class="primary">最初からやり直す</button>
        </div>
      </section>
    </div>

    
  </main>

  <script>
    const nodes = {
      start: {
        type: 'question',
        title: '種別を選択',
        text: '該当する返礼品の種別を選択してください。',
        options: [
          { label: '生鮮食品（加工していないもの）', next: 'freshCategory' },
          { label: '加工品', next: 'processedStart' },
          { label: 'サービス提供', next: 'serviceCategory' }
        ]
      },
      freshCategory: {
        type: 'question',
        title: '生鮮食品の分類',
        text: '該当する生鮮食品の分類を選択してください。',
        options: [
          { label: '農産物（穀物・野菜・果物など）', next: 'freshAgricultureAllHyuga' },
          { label: '水産物（魚介・海藻など）', next: 'freshFishAllHyuga' },
          { label: '畜産物（肉・卵など）', next: 'freshLivestockAllHyuga' },
        ]
      },
      freshAgricultureAllHyuga: {
        type: 'question',
        title: '農産物の原材料',
        text: '原材料は全て日向市で栽培・生産・収穫されたものですか？',
        options: [
          { label: 'はい', next: 'resultType1' },
          { label: 'いいえ', next: 'mixedUnavoidable' }
        ]
      },
      freshFishAllHyuga: {
        type: 'question',
        title: '水産物の原材料',
        text: '原材料は全て日向市で水揚げ・養殖されたものですか？',
        options: [
          { label: 'はい', next: 'resultType1' },
          { label: 'いいえ', next: 'mixedUnavoidable' }
        ]
      },
      freshLivestockAllHyuga: {
        type: 'question',
        title: '畜産物の原材料',
        text: '原材料は全て日向市で飼養されたものですか？',
        options: [
          { label: 'はい', next: 'resultType1' },
          { label: 'いいえ', next: 'mixedUnavoidable' }
        ]
      },
      mixedUnavoidable: {
        type: 'question',
        title: '混在の有無',
        text: '仕入れや流通の過程において、仕方なく市外産のものと日向市産のものが混在してしまうものですか？',
        options: [
          { label: 'はい', next: 'resultType4' },
          { label: 'いいえ', next: 'resultNotEligible' }
        ]
      },
       processedStart: {
        type: 'question',
        title: '加工品の分類',
        text: '該当商品は熟成肉または精米ですか？',
        options: [
          { label: 'はい', next: 'freshAgingProcess' },
          { label: 'いいえ', next: 'processedUseLocal' }
        ]
      },
      freshAgingProcess: {
        type: 'question',
        title: '原材料・熟成・精米工程',
        text: '原材料は宮崎県産で、日向市内で肉の熟成または玄米の精米を行っていますか？',
        options: [
          { label: 'はい', next: 'resultType3i' },
          { label: 'いいえ', next: 'resultNotEligible' }
        ]
      },
      processedUseLocal: {
        type: 'question',
        title: '原材料の使用割合',
        text: '原材料に日向市産のものを一定程度使用していますか？',
        options: [
          { label: 'はい', next: 'resultType2' },
          { label: 'いいえ', next: 'processedPlanning' }
        ]
      },
      processedPlanning: {
        type: 'question',
        title: '主要工程の内容',
        text: '主要な加工・製造（または企画立案・商品設計）を事業者自身が日向市内で行っていますか？',
        options: [
          { label: 'はい', next: 'processedAdd' },
          { label: 'いいえ', next: 'processedCityPromo' }
        ]
      },
      processedAdd: {
        type: 'question',
        title: '加工・製造工程',
        text: '日向市内で行われる主要な加工・製造工程は原材料に実質的な変更を加えるものですか？',
        options: [
          { label: 'はい', next: 'processedPacking' },
          { label: 'いいえ', next: 'processedStudy' }
        ]
      },
      processedPacking: {
        type: 'question',
        title: '梱包',
        text: 'その工程は単なる「切断」や「混合」、保存のための「乾燥・冷凍・塩水漬等」「梱包」だけに留まっていませんか？',
        options: [
          { label: 'はい', next: 'resultType3' },
          { label: 'いいえ', next: 'resultNotEligible' }
        ]
      },
      processedStudy: {
        type: 'question',
        title: '研究開発等',
        text: '日向市内で行われる主要な工程は、企画立案や商品設計、研究開発等ですか？',
        options: [
          { label: 'はい', next: 'resultType3r' },
          { label: 'いいえ', next: 'resultNotEligible' }
        ]
      },
      processedCityPromo: {
        type: 'question',
        title: 'シティープロモーション該当',
        text: '日向市がシティープロモーションの目的で製作したキャラクターを用いたグッズですか？',
        options: [
          { label: 'はい', next: 'resultType5' },
          { label: 'いいえ', next: 'resultNotEligible' }
        ]
      },

      processedMainProcess: {
        type: 'question',
        title: '加工・製造工程の実質性',
        text: '日向市内で行われる主要な加工・製造工程は原材料に実質的な変更を加えるものですか？',
        options: [
          { label: 'はい', next: 'processedNotSimple' },
          { label: 'いいえ', next: 'resultNotEligible' }
        ]
      },
      processedNotSimple: {
        type: 'question',
        title: '単純工程の該当有無',
        text: 'その工程は単なる「切断」「混合」、保存のための「乾燥・冷凍・塩水漬等」「梱包」だけに留まっていませんか？',
        options: [
          { label: 'はい', next: 'processedByBusiness' },
          { label: 'いいえ', next: 'resultNotEligible' }
        ]
      },
      processedByBusiness: {
        type: 'question',
        title: '市内事業者による工程実施',
        text: '主要な加工・製造（または企画立案・商品設計）を事業者自身が日向市内で行っていると言えますか？',
        options: [
          { label: 'はい', next: 'resultProcessedEligible' },
          { label: 'いいえ', next: 'resultNotEligible' }
        ]
      },
      serviceCategory: {
        type: 'question',
        title: 'サービス種別',
        text: '提供するサービスの種類を選択してください。',
        options: [
          { label: '宿泊サービス（日向市内に所在する宿泊施設に限る）', next: 'serviceLodgingOperators' },
          { label: '宿泊以外のサービス', next: 'serviceOtherRelation' }
        ]
      },
      serviceLodgingOperators: {
        type: 'question',
        title: '宿泊施設の運営状況',
        text: '日向市内に所在し、県外へのフランチャイズ展開をしていない施設ですか？',
        options: [
          { label: 'はい', next: 'resultType7_2' },
          { label: 'いいえ', next: 'serviceLodgingPrice' }
        ]
      },
      serviceLodgingPrice: {
        type: 'question',
        title: '宿泊プランの価格',
        text: 'サービス（食事を含む）の費用が1泊1人あたり5万円を超えていませんか？',
        options: [
          { label: 'はい、5万円以下です', next: 'resultType7_3i' },
          { label: 'いいえ、5万円を超えます', next: 'resultNotEligible' }
        ]
      },
      serviceOtherRelation: {
        type: 'question',
        title: 'サービスの地域関連性',
        text: 'サービスの主要な部分が日向市に相当程度関連しており、全国的に展開しているものではありませんか？',
        options: [
          { label: 'はい', next: 'resultType7' },
          { label: 'いいえ', next: 'resultNotEligible' }
        ]
      },
      resultType1: {
        type: 'result',
        messages: ['類型1']
      },
      resultType2: {
        type: 'result',
        messages: [
          '類型2',
          '※付加価値割合による'
        ]
      },
      resultType3: {
        type: 'result',
        messages: [
          '類型3',
          '※付加価値割合の算出方法については今後厳しく制限される見込みです。'
        ]
      },
      resultType3r: {
        type: 'result',
        messages: ['類型3-ロ(条件あり)']
      },
      resultType4: {
        type: 'result',
        messages: ['類型4']
      },
      resultType3i: {
        type: 'result',
        messages: ['類型3-イ']
      },

      resultType5: {
        type: 'result',
        messages: [
          '類型5',
          '※今後、厳しく制限がかかる見込みです。'
        ]
      },
      resultType7_2: {
        type: 'result',
        messages: [
          '類型7-2',
        ]
      },
      resultType7_3i: {
        type: 'result',
        messages: [
          '類型7-3イ',
        ]
      },
      resultType7: {
        type: 'result',
        messages: ['類型7']
      },
      resultNotEligible: {
        type: 'result',
        messages: ['申し訳ありませんが、日向市の返礼品としてはお取扱いができません']
      }
    };

    const questionTitleEl = document.getElementById('questionTitle');
    const questionTextEl = document.getElementById('questionText');
    const optionsEl = document.getElementById('options');
    const resultEl = document.getElementById('result');
    const trailEl = document.getElementById('trail');
    const backButton = document.getElementById('backButton');
    const restartButton = document.getElementById('restartButton');

    let stack = ['start'];
    let trail = [];

    function renderNode(nodeId) {
      const node = nodes[nodeId];
      if (!node) return;

      updateTrail();

      if (node.type === 'question') {
        resultEl.style.display = 'none';
        questionTitleEl.textContent = node.title || '質問';
        questionTextEl.textContent = node.text;
        optionsEl.innerHTML = '';
        node.options.forEach(option => {
          const button = document.createElement('button');
          button.className = 'option';
          button.type = 'button';
          button.textContent = option.label;
          button.addEventListener('click', () => handleOption(option));
          optionsEl.appendChild(button);
        });
      } else if (node.type === 'result') {
        questionTitleEl.textContent = '判定結果';
        questionTextEl.textContent = '選択内容に基づく判定結果です。';
        optionsEl.innerHTML = '';
        resultEl.innerHTML = '';
        const list = document.createElement('ul');
        node.messages.forEach(message => {
          const li = document.createElement('li');
          li.textContent = message;
          list.appendChild(li);
        });
        resultEl.appendChild(list);
        resultEl.style.display = 'block';
      }

      backButton.disabled = stack.length <= 1;
    }

    function handleOption(option) {
      trail.push(option.label);
      stack.push(option.next);
      renderNode(option.next);
    }

    function goBack() {
      if (stack.length > 1) {
        stack.pop();
        trail.pop();
        renderNode(stack[stack.length - 1]);
      }
    }

    function restart() {
      stack = ['start'];
      trail = [];
      renderNode('start');
    }

    function updateTrail() {
      trailEl.innerHTML = '';
      if (trail.length === 0) {
        const li = document.createElement('li');
        li.textContent = '開始';
        trailEl.appendChild(li);
      } else {
        const startLi = document.createElement('li');
        startLi.textContent = '開始';
        trailEl.appendChild(startLi);
        trail.forEach((label, index) => {
          const li = document.createElement('li');
          li.textContent = label;
          trailEl.appendChild(li);
        });
      }
    }

    backButton.addEventListener('click', goBack);
    restartButton.addEventListener('click', restart);

    renderNode('start');
  </script>
</body>
</html>